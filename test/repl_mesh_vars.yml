---
# Mesh replication test: 2 suppliers (ds-s1, ds-s2) and 2 consumers (ds-c1, ds-c2)

dirsrv_password: "{{ vault_dirsrv_password | default('password') }}"
dirsrv_manage_service: false
dirsrv_instance: "localhost"
dirsrv_ldapi_socket_path: "/data/run/slapd-{{ dirsrv_instance }}.socket"
dirsrv_ldapi_uri: "ldapi://{{ dirsrv_ldapi_socket_path | regex_replace('/', '%2F') }}"

dirsrv_repl_suffixes:
  - "dc=example,dc=com"

dirsrv_repl_nodes:
  ds-s1: { role: supplier, instance: "localhost", host: "s1.dsnet.test", port: 3389, protocol: LDAP }
  ds-c1: { role: consumer, instance: "localhost", host: "c1.dsnet.test", port: 3389, protocol: LDAP }
  ds-s2: { role: supplier, instance: "localhost", host: "s2.dsnet.test", port: 3389, protocol: LDAP }
  ds-c2: { role: consumer, instance: "localhost", host: "c2.dsnet.test", port: 3389, protocol: LDAP }

dirsrv_repl_replica_ids:
  "dc=example,dc=com":
    ds-s1: 1
    ds-s2: 2

dirsrv_repl_auth:
  method: SIMPLE
  bind_dn: "cn=Directory Manager"
  bind_password: "{{ dirsrv_password }}"

dirsrv_repl_agreements:
  "dc=example,dc=com":
    # Supplier-to-supplier (bi-directional), init from ds-s1 to ds-s2
    - { from: "ds-s1", to: "ds-s2", name: "s1-to-s2", init: true }
    - { from: "ds-s2", to: "ds-s1", name: "s2-to-s1", init: false }
    # Supplier-to-consumer
    - { from: "ds-s1", to: "ds-c1", name: "s1-to-c1", init: true }
    - { from: "ds-s2", to: "ds-c2", name: "s2-to-c2", init: true }

dirsrv_repl_set_release_timeout: false
dirsrv_repl_run_replcheck: false

# Lab-only: avoid suffix-level referrals masking local state
rhds_disable_referrals: true

# Enable post-enable verification in role (bind + config checks)
dirsrv_repl_verify_post_enable: true

# Tighter wait thresholds for fast lab runs
rhds_repl_wait_stale_seconds: 60
rhds_repl_wait_steady_ok_polls: 2
rhds_repl_wait_delay: 2
rhds_repl_wait_timeout: 240
rhds_repl_wait_require_finished: true
rhds_repl_wait_timeout_configured: 20
rhds_repl_wait_timeout_start: 30
rhds_repl_wait_timeout_done: 120
